<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>OBLIRIM PWN Master</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <style>
        /* Lightweight Hacker Theme - Optimized for Pi 3 */
        :root {
            --bg: #000;
            --bg-panel: #111;
            --green: #0f0;
            --cyan: #0ff;
            --red: #f04;
            --yellow: #ff0;
            --gray: #666;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--green);
            font: 11px 'Courier New', monospace;
            height: 100vh;
            max-width: 1080px;
            margin: 0 auto;
            padding: 10px;
        }

        .header {
            text-align: center;
            border-bottom: 1px solid var(--green);
            padding: 10px 0;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 16px;
            letter-spacing: 2px;
        }

        .warning-banner {
            font-size: 8px;
            color: var(--red);
            text-align: center;
            margin-top: 2px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Main content area */
        .main-content {
            display: flex;
            gap: 10px;
            height: calc(100vh - 80px);
        }

        /* System specs - 50% */
        .specs-panel {
            flex: 0 0 50%;
            background: var(--bg-panel);
            border: 1px solid var(--green);
            padding: 10px;
            display: flex;
            flex-direction: column;
        }

        /* Ethernet panel - 50% */
        .eth-panel {
            flex: 0 0 50%;
            background: var(--bg-panel);
            border: 1px solid var(--cyan);
            padding: 10px;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            font-size: 10px;
            font-weight: bold;
            color: var(--green);
            border-bottom: 1px solid var(--gray);
            padding-bottom: 5px;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }

        .eth-panel .panel-header {
            color: var(--cyan);
        }

        .spec-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 10px;
        }

        .spec-item {
            padding: 4px;
            border: 1px solid var(--gray);
            background: var(--bg);
        }

        .spec-label {
            color: var(--cyan);
            display: inline-block;
            width: 50px;
            font-size: 9px;
        }

        .spec-value {
            color: var(--green);
            font-weight: bold;
        }

        /* Status indicators */
        .status-up { color: var(--green); }
        .status-down { color: var(--red); }
        .status-warn { color: var(--yellow); }

        /* Tabs - simplified */
        .tabs {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            background: var(--bg-panel);
            border: 1px solid var(--green);
            border-bottom: none;
            padding: 5px;
            font-size: 9px;
        }

        .tab {
            padding: 4px 8px;
            border: 1px solid var(--gray);
            background: var(--bg);
            color: var(--cyan);
            cursor: pointer;
            text-transform: uppercase;
        }

        .tab.active, .tab:hover {
            background: var(--green);
            color: var(--bg);
        }

        .tab-content {
            display: none;
            padding: 10px;
            background: var(--bg-panel);
            border: 1px solid var(--green);
            margin-top: 10px;
            font-size: 10px;
        }

        .tab-content.active {
            display: block;
        }

        /* Additional panels for other tabs */
        .secondary-panels {
            margin-top: 15px;
        }

        /* Button styling */
        .btn {
            background: var(--bg);
            border: 1px solid var(--green);
            color: var(--green);
            padding: 5px 10px;
            font: inherit;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 9px;
        }

        .btn:hover {
            background: var(--green);
            color: var(--bg);
        }

        /* Output areas */
        .output {
            background: var(--bg);
            border: 1px solid var(--gray);
            padding: 8px;
            font-size: 9px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 5px;
        }

        /* Ethernet tab specific styles */
        .eth-status {
            margin-bottom: 10px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            padding: 5px;
            background: var(--bg-panel);
            border: 1px solid var(--green);
        }

        .status-label {
            color: var(--cyan);
            font-weight: bold;
        }

        .status-value {
            color: var(--green);
            font-weight: bold;
        }

        .status-value.disconnected {
            color: var(--red);
        }

        .network-info {
            padding: 5px;
            background: var(--bg-panel);
            border: 1px solid var(--gray);
            margin-bottom: 5px;
            font-size: 10px;
        }

        .network-info div {
            margin: 2px 0;
        }

        .progress-container {
            padding: 5px;
            background: var(--bg-panel);
            border: 1px solid var(--yellow);
            margin-bottom: 10px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 9px;
            color: var(--cyan);
        }

        #current-phase {
            color: var(--yellow);
            font-weight: bold;
        }

        .progress-bar-container {
            position: relative;
            margin: 5px 0;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: var(--bg);
            border: 1px solid var(--gray);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green), var(--cyan));
            transition: width 0.3s ease;
        }

        .progress-percentage {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 8px;
            color: var(--cyan);
            font-weight: bold;
            line-height: 12px;
            text-shadow: 0 0 3px var(--bg);
        }

        .progress-message {
            font-size: 8px;
            color: var(--gray);
            margin: 3px 0;
            text-align: center;
        }

        /* Phase Indicators */
        .phase-indicators {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            padding: 5px 0;
            border-top: 1px solid var(--gray);
            border-bottom: 1px solid var(--gray);
        }

        .phase-indicator {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }

        .phase-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray);
            border: 1px solid var(--gray);
        }

        .phase-indicator.active .phase-dot {
            background: var(--yellow);
            border-color: var(--yellow);
            box-shadow: 0 0 5px var(--yellow);
            animation: pulse 1s infinite;
        }

        .phase-indicator.completed .phase-dot {
            background: var(--green);
            border-color: var(--green);
        }

        .phase-name {
            font-size: 7px;
            color: var(--gray);
        }

        .phase-indicator.active .phase-name {
            color: var(--yellow);
            font-weight: bold;
        }

        .phase-indicator.completed .phase-name {
            color: var(--green);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Blocked Warning */
        .blocked-warning {
            padding: 8px;
            background: var(--bg);
            border: 2px solid var(--red);
            margin: 10px 0;
        }

        .blocked-header {
            text-align: center;
            color: var(--red);
            font-weight: bold;
            font-size: 10px;
            margin-bottom: 5px;
            animation: blink 1s infinite;
        }

        .blocked-details {
            font-size: 8px;
            color: var(--yellow);
        }

        .blocked-details div {
            margin: 2px 0;
        }

        .eth-controls {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .eth-controls .btn {
            flex: 1;
        }

        .scan-details {
            font-size: 9px;
            color: var(--yellow);
            text-align: center;
        }

        /* Dashboard Ethernet Panel Styles */
        .eth-quick-status {
            font-size: 9px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .eth-connection-state {
            display: flex;
            justify-content: space-between;
            padding: 5px;
            background: var(--bg);
            border: 1px solid var(--cyan);
        }

        .eth-connection-state .value {
            font-weight: bold;
            color: var(--red);
        }

        .eth-connection-state .value.connected {
            color: var(--green);
        }

        .eth-network-info {
            padding: 5px;
            background: var(--bg);
            border: 1px solid var(--gray);
            font-size: 8px;
        }

        .eth-network-info div {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
        }

        .eth-network-info .label {
            color: var(--cyan);
        }

        .eth-scan-status {
            padding: 5px;
            background: var(--bg);
            border: 1px solid var(--yellow);
        }

        .scan-state {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .scan-state .value {
            font-weight: bold;
            color: var(--yellow);
        }

        .mini-progress {
            margin: 5px 0;
        }

        .mini-progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg);
            border: 1px solid var(--gray);
            overflow: hidden;
            margin: 3px 0;
        }

        .mini-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green), var(--cyan));
            width: 0%;
            transition: width 0.3s ease;
        }

        .mini-progress-text {
            font-size: 8px;
            color: var(--cyan);
            text-align: center;
        }

        .scan-summary {
            display: flex;
            justify-content: space-around;
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid var(--gray);
        }

        .scan-summary div {
            text-align: center;
        }

        .stat-label {
            color: var(--gray);
            font-size: 7px;
            display: block;
        }

        .vuln-count {
            color: var(--red);
            font-weight: bold;
        }

        .eth-blocked-notice {
            padding: 8px;
            background: var(--bg);
            border: 2px solid var(--red);
            text-align: center;
            animation: blink 1s infinite;
        }

        .blocked-icon {
            font-size: 16px;
            display: block;
        }

        .blocked-text {
            color: var(--red);
            font-weight: bold;
            font-size: 9px;
            display: block;
            margin: 3px 0;
        }

        .blocked-time {
            color: var(--yellow);
            font-size: 7px;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        /* Performance optimizations */
        * {
            -webkit-transform: translateZ(0);
            -moz-transform: translateZ(0);
            -ms-transform: translateZ(0);
            transform: translateZ(0);
        }

        /* Minimal scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--gray);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>OBLIRIM PWN MASTER</h1>
        <div class="warning-banner">
            ‚ö†Ô∏è FOR AUTHORIZED TESTING ONLY ‚ö†Ô∏è
        </div>
    </div>

    <div class="main-content">
        <!-- Left Column: System Specs (50%) -->
        <div class="specs-panel">
            <div class="panel-header">SYSTEM STATS</div>
            <div class="spec-grid">
                <div class="spec-item">
                    <span class="spec-label">Model:</span>
                    <span class="spec-value" id="pi-model">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">IP:</span>
                    <span class="spec-value" id="ip">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">WiFi0:</span>
                    <span class="spec-value status-indicator" id="wlan0">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">WiFi1:</span>
                    <span class="spec-value status-indicator" id="wlan1">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">ETH:</span>
                    <span class="spec-value status-indicator" id="eth0">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">BT:</span>
                    <span class="spec-value status-indicator" id="bluetooth">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Temp:</span>
                    <span class="spec-value" id="temperature">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">CPU:</span>
                    <span class="spec-value" id="cpu">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">RAM:</span>
                    <span class="spec-value" id="memory-percent">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Usage:</span>
                    <span class="spec-value" id="memory-usage">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Disk:</span>
                    <span class="spec-value" id="disk-percent">Loading...</span>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Space:</span>
                    <span class="spec-value" id="disk-usage">Loading...</span>
                </div>
            </div>
        </div>

        <!-- Right Column: Ethernet Status (50%) -->
        <div class="eth-panel">
            <div class="panel-header">ETHERNET STATUS</div>
            <div class="eth-quick-status">
                <div class="eth-connection-state">
                    <span class="label">Connection:</span>
                    <span class="value" id="dash-eth-status">DISCONNECTED</span>
                </div>
                <div class="eth-network-info" id="dash-network-info" style="display: none;">
                    <div><span class="label">IP:</span> <span id="dash-eth-ip">N/A</span></div>
                    <div><span class="label">Gateway:</span> <span id="dash-eth-gateway">N/A</span></div>
                    <div><span class="label">Networks:</span> <span id="dash-networks-scanned">0</span></div>
                </div>
                <div class="eth-scan-status" id="dash-scan-status">
                    <div class="scan-state">
                        <span class="label">Scan Status:</span>
                        <span class="value" id="dash-scan-state">Idle</span>
                    </div>
                    <div class="mini-progress" id="dash-progress-container" style="display: none;">
                        <div class="mini-progress-bar">
                            <div class="mini-progress-fill" id="dash-progress-fill"></div>
                        </div>
                        <div class="mini-progress-text" id="dash-progress-text">0%</div>
                    </div>
                    <div class="scan-summary" id="dash-scan-summary">
                        <div>
                            <span class="stat-label">Hosts:</span> 
                            <span id="dash-hosts-current">0</span>/<span id="dash-hosts-historical">0</span>
                        </div>
                        <div>
                            <span class="stat-label">Ports:</span> 
                            <span id="dash-ports-current">0</span>/<span id="dash-ports-historical">0</span>
                        </div>
                        <div>
                            <span class="stat-label">Vulns:</span> 
                            <span class="vuln-count" id="dash-vulns-current">0</span>/<span id="dash-vulns-historical">0</span>
                        </div>
                    </div>
                </div>
                <div class="eth-blocked-notice" id="dash-blocked-notice" style="display: none;">
                    <span class="blocked-icon">üö´</span>
                    <span class="blocked-text">Network Blocking Detected!</span>
                    <div class="blocked-time" id="dash-blocked-time"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Secondary content for other tabs -->
    <div class="secondary-panels">
        <div class="tab-content" id="eth">
            <div class="eth-status">
                <div class="status-bar">
                    <span class="status-label">Ethernet Status:</span>
                    <span class="status-value" id="eth-status">Checking...</span>
                </div>
                <div class="network-info" id="network-info" style="display: none;">
                    <div>IP: <span id="eth-ip">N/A</span></div>
                    <div>Gateway: <span id="eth-gateway">N/A</span></div>
                    <div>Networks Scanned: <span id="networks-scanned">0</span></div>
                </div>
                
                <!-- Enhanced Progress Display -->
                <div class="progress-container" id="scan-progress" style="display: none;">
                    <div class="progress-header">
                        <span>Current Phase:</span>
                        <span id="current-phase">Initializing...</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-percentage" id="progress-text">0%</div>
                    </div>
                    <div class="progress-message" id="progress-message">Preparing scan...</div>
                    
                    <!-- Phase Indicators -->
                    <div class="phase-indicators">
                        <div class="phase-indicator" id="phase-1">
                            <div class="phase-dot"></div>
                            <div class="phase-name">Detection</div>
                        </div>
                        <div class="phase-indicator" id="phase-2">
                            <div class="phase-dot"></div>
                            <div class="phase-name">Discovery</div>
                        </div>
                        <div class="phase-indicator" id="phase-3">
                            <div class="phase-dot"></div>
                            <div class="phase-name">Enumeration</div>
                        </div>
                        <div class="phase-indicator" id="phase-4">
                            <div class="phase-dot"></div>
                            <div class="phase-name">Vulnerabilities</div>
                        </div>
                    </div>
                    
                    <div class="scan-details">
                        <div class="metric">
                            <span class="metric-label">Devices:</span>
                            <span class="metric-value">
                                CPT: <span id="devices-current">0</span> | 
                                HPT: <span id="devices-historical">0</span>
                            </span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Ports:</span>
                            <span class="metric-value">
                                CPT: <span id="ports-current">0</span> | 
                                HPT: <span id="ports-historical">0</span>
                            </span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Vulnerabilities:</span>
                            <span class="metric-value">
                                CPT: <span id="vulns-current">0</span> | 
                                HPT: <span id="vulns-historical">0</span>
                            </span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Total Scans:</span>
                            <span class="metric-value" id="total-scans">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Blocked Warning -->
                <div class="blocked-warning" id="blocked-warning" style="display: none;">
                    <div class="blocked-header">‚ö†Ô∏è NETWORK BLOCKING DETECTED ‚ö†Ô∏è</div>
                    <div class="blocked-details">
                        <div>Blocked at: <span id="blocked-timestamp">N/A</span></div>
                        <div>Last successful: <span id="last-successful">N/A</span></div>
                        <div>Blocked operations: <span id="blocked-operations">0</span></div>
                    </div>
                </div>
            </div>
            
            <div class="eth-controls">
                <button class="btn" id="start-eth-scan">Start ETH Scan</button>
                <button class="btn" id="stop-eth-scan" style="display: none;">Stop Scan</button>
                <button class="btn" id="refresh-eth-logs">Refresh Logs</button>
            </div>
            
            <div class="output" id="eth-output"></div>
        </div>
        
        <div class="tab-content" id="wlan">
            <p>Wireless Tools</p>
            <button class="btn">Start WLAN Scan</button>
            <div class="output" id="wlan-output"></div>
        </div>
        
        <div class="tab-content" id="blt">
            <p>Bluetooth Tools</p>
            <button class="btn">Start BLT Scan</button>
            <div class="output" id="blt-output"></div>
        </div>
        
        <div class="tab-content" id="config">
            <p>Configuration</p>
            <button class="btn">Edit Config</button>
        </div>
    </div>

    <!-- Bottom tabs -->
    <div class="tabs">
        <div class="tab active" data-target="main">DASH</div>
        <div class="tab" data-target="eth">ETH</div>
        <div class="tab" data-target="wlan">WLAN</div>
        <div class="tab" data-target="blt">BLT</div>
        <div class="tab" data-target="config">CONFIG</div>
    </div>

    <script>
        const socket = io();
        
        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const target = tab.dataset.target;
                
                // Update active tab
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show/hide content
                if (target === 'main') {
                    document.querySelector('.main-content').style.display = 'flex';
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                } else {
                    document.querySelector('.main-content').style.display = 'none';
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    document.getElementById(target).classList.add('active');
                }
            });
        });

        // System info update
        function updateStatusIndicators(data) {
            const statusElements = {
                'wlan0': data.wlan0,
                'wlan1': data.wlan1,
                'eth0': data.eth0,
                'bluetooth': data.bluetooth
            };

            for (const [id, status] of Object.entries(statusElements)) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = status || 'N/A';
                    element.className = 'spec-value status-indicator';
                    if (status === 'Up') {
                        element.classList.add('status-up');
                    } else if (status === 'Down') {
                        element.classList.add('status-down');
                    }
                }
            }
        }

        // Socket events
        socket.on('update_data', function(data) {
            // Update all spec fields
            const fields = ['pi-model', 'ip', 'temperature', 'cpu', 'memory-percent', 'memory-usage', 'disk-percent', 'disk-usage'];
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element && data[field.replace('-', '_')]) {
                    element.textContent = data[field.replace('-', '_')];
                }
            });
            
            updateStatusIndicators(data);
        });

        socket.on('eth_log_data', function(data) {
            document.getElementById('eth-output').textContent = data;
        });

        socket.on('eth_progress', function(data) {
            updateEthProgress(data);
            // Update metrics whenever progress is reported
            updateEthMetrics();
        });

        socket.on('eth_scan_started', function(data) {
            if (data.status === 'started') {
                document.getElementById('start-eth-scan').textContent = 'Scan Running...';
                document.getElementById('start-eth-scan').disabled = true;
                document.getElementById('start-eth-scan').style.display = 'none';
                document.getElementById('stop-eth-scan').style.display = 'inline-block';
                document.getElementById('scan-progress').style.display = 'block';
                document.getElementById('dash-scan-state').textContent = 'Starting...';
            } else if (data.status === 'error') {
                alert('Scan failed: ' + data.message);
                document.getElementById('start-eth-scan').disabled = false;
            } else if (data.status === 'auto') {
                // Auto-triggered scan
                document.getElementById('scan-progress').style.display = 'block';
                document.getElementById('dash-scan-state').textContent = 'Auto-Scanning...';
                console.log('Auto-scan triggered on Ethernet connection');
            }
        });

        socket.on('eth_scan_stopped', function(data) {
            document.getElementById('start-eth-scan').textContent = 'Start ETH Scan';
            document.getElementById('start-eth-scan').disabled = false;
            document.getElementById('start-eth-scan').style.display = 'inline-block';
            document.getElementById('stop-eth-scan').style.display = 'none';
            document.getElementById('dash-scan-state').textContent = 'Stopped';
        });

        socket.on('eth_connection_change', function(data) {
            console.log('Ethernet connection changed:', data);
            if (data.connected) {
                console.log('Ethernet connected - auto-scan will trigger');
                hideBlockedNotice();
            } else {
                console.log('Ethernet disconnected');
                document.getElementById('dash-scan-state').textContent = 'Disconnected';
            }
            updateEthStatus();
        });

        socket.on('network_blocked', function(data) {
            showBlockedNotice(data.message || 'Network blocking detected');
            const blockedOps = document.getElementById('blocked-operations');
            if (blockedOps && data.count) {
                blockedOps.textContent = data.count;
            }
        });

        socket.on('connect', () => {
            console.log('Connected to server');
        });

        // Button handlers
        document.getElementById('start-eth-scan')?.addEventListener('click', () => {
            socket.emit('start_eth_scan');
            document.getElementById('start-eth-scan').style.display = 'none';
            document.getElementById('stop-eth-scan').style.display = 'inline-block';
            hideBlockedNotice();
        });

        document.getElementById('stop-eth-scan')?.addEventListener('click', () => {
            socket.emit('stop_eth_scan');
            document.getElementById('start-eth-scan').style.display = 'inline-block';
            document.getElementById('stop-eth-scan').style.display = 'none';
        });

        document.getElementById('refresh-eth-logs')?.addEventListener('click', () => {
            socket.emit('request_eth_logs');
        });

        // Ethernet progress update function
        function updateEthProgress(data) {
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const scanProgress = document.getElementById('scan-progress');
            const currentPhase = document.getElementById('current-phase');
            const progressMessage = document.getElementById('progress-message');
            
            // Dashboard mini progress
            const dashProgressFill = document.getElementById('dash-progress-fill');
            const dashProgressText = document.getElementById('dash-progress-text');
            const dashProgressContainer = document.getElementById('dash-progress-container');
            const dashScanState = document.getElementById('dash-scan-state');
            
            if (data.progress > 0) {
                scanProgress.style.display = 'block';
                progressFill.style.width = data.progress + '%';
                progressText.textContent = data.progress + '%';
                progressMessage.textContent = data.message || '';
                
                // Update dashboard
                dashProgressContainer.style.display = 'block';
                dashProgressFill.style.width = data.progress + '%';
                dashProgressText.textContent = data.progress + '%';
                dashScanState.textContent = 'Scanning...';
                dashScanState.style.color = 'var(--yellow)';
            }
            
            // Update phase
            if (data.phase) {
                currentPhase.textContent = data.phase.replace('phase', 'Phase ').replace('_', ' ');
                
                // Update phase indicators
                const phaseNum = data.phase.match(/\d+/);
                if (phaseNum) {
                    const num = parseInt(phaseNum[0]);
                    for (let i = 1; i <= 4; i++) {
                        const indicator = document.getElementById('phase-' + i);
                        if (i < num) {
                            indicator.className = 'phase-indicator completed';
                        } else if (i === num) {
                            indicator.className = 'phase-indicator active';
                        } else {
                            indicator.className = 'phase-indicator';
                        }
                    }
                }
            }
            
            // Update statistics
            if (data.data) {
                if (data.data.hosts !== undefined) {
                    document.getElementById('devices-found').textContent = data.data.hosts;
                    document.getElementById('dash-hosts').textContent = data.data.hosts;
                }
                if (data.data.ports !== undefined) {
                    document.getElementById('open-ports').textContent = data.data.ports;
                    document.getElementById('dash-ports').textContent = data.data.ports;
                }
                if (data.data.vulnerabilities !== undefined) {
                    document.getElementById('vulnerabilities').textContent = data.data.vulnerabilities;
                    document.getElementById('dash-vulns').textContent = data.data.vulnerabilities;
                }
            }
            
            // Handle completion
            if (data.phase === 'complete') {
                document.getElementById('start-eth-scan').textContent = 'Start ETH Scan';
                document.getElementById('start-eth-scan').disabled = false;
                document.getElementById('stop-eth-scan').style.display = 'none';
                
                dashScanState.textContent = 'Complete';
                dashScanState.style.color = 'var(--green)';
                
                // Mark all phases as completed
                for (let i = 1; i <= 4; i++) {
                    document.getElementById('phase-' + i).className = 'phase-indicator completed';
                }
            }
            
            // Handle errors or blocking
            if (data.phase === 'error' || data.phase === 'blocked') {
                document.getElementById('start-eth-scan').disabled = false;
                document.getElementById('stop-eth-scan').style.display = 'none';
                dashScanState.textContent = 'Error';
                dashScanState.style.color = 'var(--red)';
                
                if (data.phase === 'blocked') {
                    showBlockedNotice(data.message || 'Network blocking detected');
                }
            }
        }

        // Update Ethernet status
        function updateEthStatus() {
            const ethStatus = document.getElementById('eth-status');
            const networkInfo = document.getElementById('network-info');
            const ethIp = document.getElementById('eth-ip');
            const ethGateway = document.getElementById('eth-gateway');
            const networksScanned = document.getElementById('networks-scanned');
            
            // Dashboard elements
            const dashEthStatus = document.getElementById('dash-eth-status');
            const dashNetworkInfo = document.getElementById('dash-network-info');
            const dashEthIp = document.getElementById('dash-eth-ip');
            const dashEthGateway = document.getElementById('dash-eth-gateway');
            const dashNetworksScanned = document.getElementById('dash-networks-scanned');
            
            // Check eth0 status from system data
            const eth0Element = document.getElementById('eth0');
            if (eth0Element) {
                const isUp = eth0Element.textContent === 'Up';
                if (isUp) {
                    ethStatus.textContent = 'CONNECTED';
                    ethStatus.className = 'status-value';
                    networkInfo.style.display = 'block';
                    
                    // Dashboard
                    dashEthStatus.textContent = 'CONNECTED';
                    dashEthStatus.className = 'value connected';
                    dashNetworkInfo.style.display = 'block';
                    
                    // Fetch actual network info
                    fetch('/api/eth/status')
                        .then(response => response.json())
                        .then(data => {
                            if (data.ip) {
                                ethIp.textContent = data.ip;
                                dashEthIp.textContent = data.ip;
                            }
                            if (data.gateway) {
                                ethGateway.textContent = data.gateway;
                                dashEthGateway.textContent = data.gateway;
                            }
                        })
                        .catch(err => console.error('Error fetching eth status:', err));
                    
                    // Fetch network tally
                    fetch('/api/network/tally')
                        .then(response => response.json())
                        .then(data => {
                            const count = data.total_networks || 0;
                            networksScanned.textContent = count;
                            dashNetworksScanned.textContent = count;
                        })
                        .catch(() => {
                            networksScanned.textContent = '0';
                            dashNetworksScanned.textContent = '0';
                        });
                    
                    // Fetch and update metrics
                    updateEthMetrics();
                } else {
                    ethStatus.textContent = 'DISCONNECTED';
                    ethStatus.className = 'status-value disconnected';
                    networkInfo.style.display = 'none';
                    
                    // Dashboard
                    dashEthStatus.textContent = 'DISCONNECTED';
                    dashEthStatus.className = 'value';
                    dashNetworkInfo.style.display = 'none';
                    
                    // Show historical data on dashboard
                    document.getElementById('dash-scan-state').textContent = 'Idle (No Connection)';
                }
            }
        }
        
        // Update Ethernet metrics (current + historical)
        function updateEthMetrics() {
            fetch('/api/eth/metrics')
                .then(response => response.json())
                .then(data => {
                    // Update ETH tab metrics
                    document.getElementById('devices-current').textContent = data.current.hosts || 0;
                    document.getElementById('devices-historical').textContent = data.historical.hosts || 0;
                    document.getElementById('ports-current').textContent = data.current.ports || 0;
                    document.getElementById('ports-historical').textContent = data.historical.ports || 0;
                    document.getElementById('vulns-current').textContent = data.current.vulnerabilities || 0;
                    document.getElementById('vulns-historical').textContent = data.historical.vulnerabilities || 0;
                    document.getElementById('total-scans').textContent = data.historical.scans || 0;
                    
                    // Update Dashboard metrics
                    document.getElementById('dash-hosts-current').textContent = data.current.hosts || 0;
                    document.getElementById('dash-hosts-historical').textContent = data.historical.hosts || 0;
                    document.getElementById('dash-ports-current').textContent = data.current.ports || 0;
                    document.getElementById('dash-ports-historical').textContent = data.historical.ports || 0;
                    document.getElementById('dash-vulns-current').textContent = data.current.vulnerabilities || 0;
                    document.getElementById('dash-vulns-historical').textContent = data.historical.vulnerabilities || 0;
                })
                .catch(err => console.error('Error fetching eth metrics:', err));
        }

        // Show blocked notice
        function showBlockedNotice(message) {
            const blockedWarning = document.getElementById('blocked-warning');
            const dashBlockedNotice = document.getElementById('dash-blocked-notice');
            const blockedTimestamp = document.getElementById('blocked-timestamp');
            const dashBlockedTime = document.getElementById('dash-blocked-time');
            
            const now = new Date().toLocaleString();
            
            if (blockedWarning) {
                blockedWarning.style.display = 'block';
                if (blockedTimestamp) {
                    blockedTimestamp.textContent = now;
                }
            }
            
            if (dashBlockedNotice) {
                dashBlockedNotice.style.display = 'block';
                if (dashBlockedTime) {
                    dashBlockedTime.textContent = 'Blocked at: ' + now;
                }
            }
            
            console.error('Network blocking detected:', message);
        }

        // Hide blocked notice
        function hideBlockedNotice() {
            const blockedWarning = document.getElementById('blocked-warning');
            const dashBlockedNotice = document.getElementById('dash-blocked-notice');
            
            if (blockedWarning) blockedWarning.style.display = 'none';
            if (dashBlockedNotice) dashBlockedNotice.style.display = 'none';
        }

        // Update Ethernet status when system data updates
        const originalUpdateData = socket.on('update_data', function(data) {
            // Update all spec fields
            const fields = ['pi-model', 'ip', 'temperature', 'cpu', 'memory-percent', 'memory-usage', 'disk-percent', 'disk-usage'];
            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element && data[field.replace('-', '_')]) {
                    element.textContent = data[field.replace('-', '_')];
                }
            });
            
            updateStatusIndicators(data);
            updateEthStatus(); // Update Ethernet status
        });

        // Initial Ethernet logs request
        setTimeout(() => {
            socket.emit('request_eth_logs');
            updateEthMetrics(); // Initial metrics load
        }, 1000);
        
        // Periodic metrics update (every 3 seconds)
        setInterval(() => {
            updateEthMetrics();
        }, 3000);
    </script>
</body>
</html>
</body>
</html>